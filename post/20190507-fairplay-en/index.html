<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Under the hood: the FairPlay DApp (with FAQs) - CyberMiles News and Articles</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="CyberMiles" />
  <meta name="description" content="In this article, I will explain the technical details behind the FairPlay DApp. If you haven&#39;t tried this DApp, please have a look at FairPlay: decentralized prize drawing for e-commerce.
 Talk is cheap, show me your code!
 Sure, please see here. Any pull request or issue is welcome ;)
Overview This DApp is based on standard web technologies. It uses the web3-cmt.js JavaScript library to interact with the smart contract." />

  <meta name="keywords" content="CyberMiles, CMT, blockchain, e-commerce, commerce, bitcoin, smart contract" />






<meta name="generator" content="Hugo 0.62.2" />


<link rel="canonical" href="http://blog.cybermiles.io/post/20190507-fairplay-en/" />



<link rel="icon" href="/favicon.ico" />










<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">





<meta itemprop="name" content="Under the hood: the FairPlay DApp (with FAQs)">
<meta itemprop="description" content="In this article, I will explain the technical details behind the FairPlay DApp. If you haven&#39;t tried this DApp, please have a look at FairPlay: decentralized prize drawing for e-commerce.
 Talk is cheap, show me your code!
 Sure, please see here. Any pull request or issue is welcome ;)
Overview This DApp is based on standard web technologies. It uses the web3-cmt.js JavaScript library to interact with the smart contract.">
<meta itemprop="datePublished" content="2019-05-07T10:01:23&#43;08:00" />
<meta itemprop="dateModified" content="2019-05-07T10:01:23&#43;08:00" />
<meta itemprop="wordCount" content="643">



<meta itemprop="keywords" content="DApp,development," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Under the hood: the FairPlay DApp (with FAQs)"/>
<meta name="twitter:description" content="In this article, I will explain the technical details behind the FairPlay DApp. If you haven&#39;t tried this DApp, please have a look at FairPlay: decentralized prize drawing for e-commerce.
 Talk is cheap, show me your code!
 Sure, please see here. Any pull request or issue is welcome ;)
Overview This DApp is based on standard web technologies. It uses the web3-cmt.js JavaScript library to interact with the smart contract."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-120065893-12', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<meta property="og:title" content="Under the hood: the FairPlay DApp (with FAQs) - CyberMiles News and Articles">
  <meta property="og:description" content="In this article, I will explain the technical details behind the FairPlay DApp. If you haven&#39;t tried this DApp, please have a look at FairPlay: decentralized prize drawing for e-commerce.
 Talk is cheap, show me your code!
 Sure, please see here. Any pull request or issue is welcome ;)
Overview This DApp is based on standard web technologies. It uses the web3-cmt.js JavaScript library to interact with the smart contract." />
<meta property="og:image" content="https://blog.cybermiles.io/logo_symbol.png">
<meta property="og:url" content="http://blog.cybermiles.io/post/20190507-fairplay-en/">


</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://www.cybermiles.io" class="logo">
      <img src="/logo-small.png">
      
    </a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          <a class="menu-item-link" href="http://blog.cybermiles.io/categories/en">English</a>
        
      </li><li class="mobile-menu-item">
        
          
          <a class="menu-item-link" href="http://blog.cybermiles.io/categories/zh">中文</a>
        
      </li><li class="mobile-menu-item">
        
          
          <a class="menu-item-link" href="http://blog.cybermiles.io/categories/ko">한국어</a>
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="https://www.cybermiles.io" class="logo">
    <img src="/logo.png">
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          <a class="menu-item-link" href="http://blog.cybermiles.io/categories/en">English</a>

        

      </li>
    
      <li class="menu-item">
        
          
          <a class="menu-item-link" href="http://blog.cybermiles.io/categories/zh">中文</a>

        

      </li>
    
      <li class="menu-item">
        
          
          <a class="menu-item-link" href="http://blog.cybermiles.io/categories/ko">한국어</a>

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Under the hood: the FairPlay DApp (with FAQs)</h1>
      
      <div class="post-meta">
        <span class="post-time"> May 7, 2019 </span>
        <div class="post-category">
            <a href="http://blog.cybermiles.io/categories/en/"> en </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      <p>In this article, I will explain the technical details behind the FairPlay DApp. If you haven't tried this DApp, please have a look at <a href="https://blog.cybermiles.io/post/20190502-fairplay-en/">FairPlay: decentralized prize drawing for e-commerce</a>.</p>
<blockquote>
<p>Talk is cheap, show me your code!</p>
</blockquote>
<p>Sure, please see <a href="https://github.com/CyberMiles/smart_contracts/tree/master/FairPlay">here</a>. Any pull request or issue is welcome ;)</p>
<h2 id="overview">Overview</h2>
<p>This DApp is based on standard web technologies. It uses the <a href="https://cybermiles.github.io/web3-cmt.js/">web3-cmt.js</a> JavaScript library to interact with the smart contract. When you scan the QRcode to <a href="https://blog.cybermiles.io/post/20190502-fairplay-creator-en/">create a drawing</a> or <a href="https://blog.cybermiles.io/post/20190502-fairplay-player-en/">participate in a drawing</a>), the DApp will render in a <code>WebView</code> in your CMT Wallet application.</p>
<p>Anytime when the user creates a new FairPlay drawing, a new contract is deployed on the CyberMiles public blockchain. In the new contract, we use <code>mapping (address =&gt; Player) players; </code> to store the basic information of the participants. To be more specific, the <code>Player</code> struct is as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">struct Player {
    uint ts;
    string name;
    string contact;
    string mesg;
    string confirm_mesg;
}
</code></pre></td></tr></table>
</div>
</div><p>The variable <code>ts</code> specifies the time when the player participates in the play. The <code>name</code> and <code>contact</code> can be picked by the user as he wants. The <code>contact</code> can be entered in a number of ways, such as E-mail, Telegram, Twitter, etc. It's worth noting that the user doesn't need to enter his private information &ndash; he can enter an anonymous twitter account or email address as long as he can be reached via them in case he wins. The <code>mesg</code> is the note the player leaves when he participates, whereas the <code>confirm_mesg</code> is the final comment given by the winner. Both messages are public.</p>
<h2 id="faq">FAQ</h2>
<ol>
<li>
<p>What happens when different people in different time zones participate in the same Fair Play Drawing?</p>
<ul>
<li>Interesting question. The answer is that the Date Time shown in the DApp varies with the user's local time zone. It is impossible to deceive the contract about the time. Sounds really smart, right? The solution is as following:
<ul>
<li><strong>When create the play</strong>: The Date Time picked by the user as the end time, is converted to a timestamp as seconds since Unix epoch, according to the user's local time zone, then is sent to the contract, where it is compared against the special variable <code>now</code> (the current block timestamp as seconds since Unix epoch), in order to make sure the drawing time is after now.</li>
<li><strong>When participate in the play</strong>: The front-end first gets the timestamp from the contract, then converts this timestamp to the readable date time, according to the user's local time zone.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Is this DApp partially or completely decentralized?</p>
<ul>
<li>We are completely decentralized! Yeah, you might be wondering how we manage to save the pictures uploaded in a totally decentralized DApp, without a back-end server. It could be possible to encode the whole picture and then store it on our blockchain. But that would a terrible waste of blockchain storage space (and gas fees). Instead, our DApp first directly uploads your picture from the browser to <a href="https://cloudinary.com/documentation/upload_images#direct_uploading_from_the_browser">cloudinary</a>, a secure and public platform providing  media management services, and then fetches the URL from this platform and stores it on the CyberMiles public blockchain.</li>
</ul>
</li>
<li>
<p>Is the FairPlay DApp really fair?</p>
<ul>
<li>
<p>Yes! We have built-in function <a href="https://www.litylang.org/rand/">rand()</a> to generate the real random number. The relevant part of code to calculate the winners is as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// Construct the winner_addresses array
for (i=0; i&lt;player_addresses.length; i++) {
    cache.push(player_addresses[i]);
}
for (i=0; i&lt;number_of_winners; i++) {
    uint r = rand () % cache.length;
    winner_addresses.push(cache[r]);
    cache[r] = cache[cache.length-1];
    delete cache[cache.length-1];
    cache.length--;
}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>How many languages does it support now?</p>
<ul>
<li>Now only the English and Chinese are supported. If you are interested in this DApp and willing to contribute to the translation of other languages, please go to follow the format of <a href="https://github.com/CyberMiles/smart_contracts/blob/master/FairPlay/dapp/js/language/en.js">this file</a> and make a pull request. Thanks.</li>
</ul>
</li>
</ol>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">CyberMiles</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">May 7, 2019</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://blog.cybermiles.io/tags/dapp/">DApp</a>
          <a href="http://blog.cybermiles.io/tags/development/">development</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/20190508-cmtrelease-zh/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">CyberMiles基金会解锁情况说明</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/20190417-vote-zh/">
            <span class="next-text nav-default">社区投票：CMT Wallet是否应该尽快开通权益投票功能</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:contact@cybermiles.io" rel="me noopener" class="iconfont icon-email"
        title="email">
      </a>
      <a href="https://twitter.com/cybermiles" rel="me noopener" class="iconfont icon-twitter"
        title="twitter" target="_blank">
      </a>
      <a href="https://www.facebook.com/cybermiles/" rel="me noopener" class="iconfont icon-facebook"
        title="facebook" target="_blank">
      </a>
      <a href="https://github.com/CyberMiles/" rel="me noopener" class="iconfont icon-github"
        title="github" target="_blank">
      </a>
      <a href="https://www.weibo.com/Cybermiles" rel="me noopener" class="iconfont icon-weibo"
        title="weibo" target="_blank">
      </a>
  <a href="http://blog.cybermiles.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
  </div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2018 -
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">
        CyberMiles
        
      </span></span>

  
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











</body>
</html>
